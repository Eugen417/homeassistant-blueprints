id: simple_light_schedule_presence
alias: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –°–≤–µ—Ç–æ–º- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∏ –ü—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ

blueprint:
  name: üí° –°–≤–µ—Ç- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ + –î–∞—Ç—á–∏–∫ –ü—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è
  description: |
    –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º—ã:
    1. **–î–ï–ù–¨ (8:00-21:00):** –°–≤–µ—Ç –≤–∫–ª—é—á–∞–µ—Ç—Å—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –∏ –æ—Å—Ç–∞–µ—Ç—Å—è ON.
    2. **–ù–û–ß–¨ (21:00-8:00):** –°–≤–µ—Ç –≤–∫–ª—é—á–∞–µ—Ç—Å—è/–≤—ã–∫–ª—é—á–∞–µ—Ç—Å—è –ø–æ –¥–∞—Ç—á–∏–∫—É –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π.
    
    **–í–Ω–∏–º–∞–Ω–∏–µ:** –í–æ –≤—Ä–µ–º—è "–î–Ω–µ–≤–Ω–æ–≥–æ" —Ä–µ–∂–∏–º–∞ –¥–∞—Ç—á–∏–∫ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è.
  domain: automation
  source_url: https://raw.githubusercontent.com/Eugen417/homeassistant-blueprints/refs/heads/main/swet_1.yaml
  
  input:
    control_entity:
      name: üí° –¶–µ–ª–µ–≤–æ–π –í—ã–∫–ª—é—á–∞—Ç–µ–ª—å/–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫
      description: –°—É—â–Ω–æ—Å—Ç—å —Ä–µ–ª–µ –∏–ª–∏ —É–º–Ω–æ–π –ª–∞–º–ø–æ—á–∫–∏, –∫–æ—Ç–æ—Ä–æ–π —É–ø—Ä–∞–≤–ª—è–µ—Ç HA.
      selector:
        entity:
          domain: [light, switch]
            
    presence_sensor:
      name: üßç –î–∞—Ç—á–∏–∫ –ü—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è
      description: –°–µ–Ω—Å–æ—Ä –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å–≤–µ—Ç–∞ –≤ –Ω–æ—á–Ω–æ–º —Ä–µ–∂–∏–º–µ.
      selector:
        entity:
          domain: binary_sensor
          
    off_delay:
      name: ‚è±Ô∏è –ó–∞–¥–µ—Ä–∂–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∏—è (–º–∏–Ω)
      description: –ó–∞–¥–µ—Ä–∂–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∏—è —Å–≤–µ—Ç–∞ –ø–æ—Å–ª–µ –ø—Ä–µ–∫—Ä–∞—â–µ–Ω–∏—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è (—Ç–æ–ª—å–∫–æ –Ω–æ—á—å—é).
      default: 3
      selector:
        number:
          min: 1
          max: 30
          unit_of_measurement: min
          mode: slider
          
    day_start_time:
      name: ‚è∞ –ù–∞—á–∞–ª–æ "–î–Ω–µ–≤–Ω–æ–≥–æ" —Ä–µ–∂–∏–º–∞ (8:00)
      default: '08:00:00'
      selector:
        time:
        
    night_start_time:
      name: ‚è∞ –ù–∞—á–∞–ª–æ "–ù–æ—á–Ω–æ–≥–æ" —Ä–µ–∂–∏–º–∞ (21:00)
      default: '21:00:00'
      selector:
        time:
          
mode: restart

trigger:
  # 1. –í–†–ï–ú–Ø: –ù–∞—á–∞–ª–æ –î–Ω–µ–≤–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
  - platform: time
    at: !input day_start_time
    id: 'day_start'
  # 2. –í–†–ï–ú–Ø: –ù–∞—á–∞–ª–æ –ù–æ—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
  - platform: time
    at: !input night_start_time
    id: 'night_start'

  # 3. –î–ê–¢–ß–ò–ö: –ü—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ
  - platform: state
    entity_id: !input presence_sensor
    to: 'on'
    id: 'presence_on'
    
  # 4. –î–ê–¢–ß–ò–ö: –ü—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
  - platform: state
    entity_id: !input presence_sensor
    to: 'off'
    id: 'presence_off'

action:
  - choose:
    
    # =======================================================
    # 0. –ù–ê–ß–ê–õ–û –î–ù–ï–í–ù–û–ì–û –†–ï–ñ–ò–ú–ê (Day Start - 8:00)
    # =======================================================
    # –í–∫–ª—é—á–∞–µ—Ç —Å–≤–µ—Ç –≤ 8:00
    - conditions:
        - condition: trigger
          id: 'day_start'
      sequence:
        - service: homeassistant.turn_on
          data: 
            entity_id: !input control_entity
          
    # =======================================================
    # 1. –ù–ê–ß–ê–õ–û –ù–û–ß–ù–û–ì–û –†–ï–ñ–ò–ú–ê (Night Start - 21:00)
    # =======================================================
    # –í—ã–∫–ª—é—á–∞–µ—Ç —Å–≤–µ—Ç –≤ 21:00, —á—Ç–æ–±—ã –ø–µ—Ä–µ–¥–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞—Ç—á–∏–∫—É
    - conditions:
        - condition: trigger
          id: 'night_start'
      sequence:
        - service: homeassistant.turn_off
          data: 
            entity_id: !input control_entity
          
    # =======================================================
    # 2. –í–ö–õ–Æ–ß–ï–ù–ò–ï –ü–û –î–ê–¢–ß–ò–ö–£ (–¢–û–õ–¨–ö–û –ù–û–ß–¨–Æ)
    # =======================================================
    - conditions:
        - condition: trigger
          id: 'presence_on'
        # –£—Å–ª–æ–≤–∏–µ: –°–µ–π—á–∞—Å –ù–æ—á—å (–¥–æ 8:00 –ò–õ–ò –ø–æ—Å–ª–µ 21:00)
        - condition: or
          conditions:
            - condition: time
              before: !input day_start_time
            - condition: time
              after: !input night_start_time
      sequence:
        - service: homeassistant.turn_on
          data: 
            entity_id: !input control_entity

    # =======================================================
    # 3. –í–´–ö–õ–Æ–ß–ï–ù–ò–ï –ü–û –î–ê–¢–ß–ò–ö–£ (–¢–û–õ–¨–ö–û –ù–û–ß–¨–Æ)
    # =======================================================
    - conditions:
        - condition: trigger
          id: 'presence_off'
        # –£—Å–ª–æ–≤–∏–µ: –°–µ–π—á–∞—Å –ù–æ—á—å (–ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –≤—ã–∫–ª—é—á–µ–Ω–∏–µ –≤ –¥–Ω–µ–≤–Ω–æ–µ –≤—Ä–µ–º—è)
        - condition: or
          conditions:
            - condition: time
              before: !input day_start_time
            - condition: time
              after: !input night_start_time
        - condition: state
          entity_id: !input control_entity
          state: 'on'
      sequence:
        - delay: 
            minutes: !input off_delay
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∑–∞–¥–µ—Ä–∂–∫–∏: –Ω—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–≤–µ—Ç –Ω–µ –≤–∫–ª—é—á–∏–ª—Å—è —Å–Ω–æ–≤–∞
        - choose:
          - conditions:
              # –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ü—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –≤—Å–µ –µ—â–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
              - condition: state
                entity_id: !input presence_sensor
                state: 'off'
              # –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –°–≤–µ—Ç –≤—Å–µ –µ—â–µ ON
              - condition: state
                entity_id: !input control_entity
                state: 'on'
            sequence:
              - service: homeassistant.turn_off
                data: 
                  entity_id: !input control_entity

    default: []