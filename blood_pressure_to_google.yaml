blueprint: 
  name: ü©∏ –ó–∞–ø–∏—Å—å –∞—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è –≤ Google + Telegram
  description: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ê–î –∏ –ø—É–ª—å—Å –≤ Google Calendar/Sheets –ò –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram.
  domain: automation
  
  source_url: https://raw.githubusercontent.com/Eugen417/homeassistant-blueprints/refs/heads/main/blood_pressure_to_google.yaml
  
  input:
    # 1. –°–ï–ù–°–û–†–´
    sensor_systolic:
      name: üìà –°–µ–Ω—Å–æ—Ä —Å–∏—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–≥–æ –ê–î (SYS –∏ –¢—Ä–∏–≥–≥–µ—Ä)
      description: –°–µ–Ω—Å–æ—Ä, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –≤–µ—Ä—Ö–Ω–µ–µ (SYS) –¥–∞–≤–ª–µ–Ω–∏–µ. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —ç—Ç–æ–≥–æ —Å–µ–Ω—Å–æ—Ä–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é.
      selector:
        entity:
          domain: sensor
          
    sensor_diastolic:
      name: üìâ –°–µ–Ω—Å–æ—Ä –¥–∏–∞—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–≥–æ –ê–î (DIA)
      description: –°–µ–Ω—Å–æ—Ä, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –Ω–∏–∂–Ω–µ–µ (DIA) –¥–∞–≤–ª–µ–Ω–∏–µ.
      selector:
        entity:
          domain: sensor

    sensor_heart_rate:
      name: ‚ù§Ô∏è –°–µ–Ω—Å–æ—Ä –ø—É–ª—å—Å–∞
      description: –°–µ–Ω—Å–æ—Ä, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —á–∞—Å—Ç–æ—Ç—É –ø—É–ª—å—Å–∞.
      selector:
        entity:
          domain: sensor

    # 2. GOOGLE CALENDAR
    google_calendar:
      name: üìÖ Google Calendar (–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
      description: –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—å Google –¥–ª—è –∑–∞–ø–∏—Å–∏ —Å–æ–±—ã—Ç–∏–π. **–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω–æ.**
      default: null 
      selector:
        entity:
          domain: calendar

    # 3. GOOGLE SHEETS
    google_sheets_config:
      name: üìë Google Sheets (–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
      description: –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (ID) –≤–∞—à–µ–π —Ç–∞–±–ª–∏—Ü—ã Google Sheets.
      selector:
        select:
          options: []
          multiple: false
          custom_value: true
          
    google_sheets_worksheet:
      name: üìù –ò–º—è –ª–∏—Å—Ç–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ
      description: –¢–æ—á–Ω–æ–µ –∏–º—è –ª–∏—Å—Ç–∞/–≤–∫–ª–∞–¥–∫–∏ –≤ –≤–∞—à–µ–π Google Sheets (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–õ–∏—Å—Ç1").
      selector:
        text:

    # 4. TELEGRAM
    telegram_notify_target:
      name: üí¨ –¶–µ–ª–µ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ Telegram
      description: –í—ã–±–µ—Ä–∏—Ç–µ *–¶–µ–ª—å* (Target) Telegram –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è.
      selector:
        target:
          entity:
            - domain: notify
            
    sheets_link:
      name: üîó –°—Å—ã–ª–∫–∞ –Ω–∞ Google Sheets
      description: URL-–∞–¥—Ä–µ—Å –≤–∞—à–µ–π —Ç–∞–±–ª–∏—Ü—ã Google Sheets –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ Telegram.
      selector:
        text:

# =======================================================================
# –ê–í–¢–û–ú–ê–¢–ò–ó–ê–¶–ò–Ø
# =======================================================================
trigger:
  - platform: state
    entity_id: !input sensor_systolic
    
condition:
  # –ü—Ä–æ–≤–µ—Ä–∫–∞ SYS > 50 –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
  - condition: numeric_state
    entity_id: !input sensor_systolic
    above: 50 

action:
  # 0. –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ü–ï–†–ï–ú–ï–ù–ù–´–•
  - variables:
      input_sensor_systolic: !input sensor_systolic
      input_sensor_diastolic: !input sensor_diastolic
      input_sensor_heart_rate: !input sensor_heart_rate
      input_google_calendar: !input google_calendar 
      input_telegram_target: !input telegram_notify_target
      input_sheets_link: !input sheets_link
      
      sys: "{{ states(input_sensor_systolic) | int(0) }}"
      dia: "{{ states(input_sensor_diastolic) | int(0) }}"
      pulse: "{{ states(input_sensor_heart_rate) | int(0) }}"
      
      time_str: "{{ now().strftime('%H:%M') }}"
      date_str: "{{ now().strftime('%d-%m-%Y') }}" # <--- –ò–ó–ú–ï–ù–ï–ù –§–û–†–ú–ê–¢ –î–ê–¢–´
      
      # –ë–õ–û–ö TELEGRAM CHAT ID
      telegram_chat_id_str: >-
        {% set target_entity_id = input_telegram_target.get('entity_id', ['']) | first | default('') %}
        
        {% set final_id = '' %}
        {% if target_entity_id %}
          {# –õ–æ–≥–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è Chat ID –∏–∑ –∏–º–µ–Ω–∏ —Å—É—â–Ω–æ—Å—Ç–∏ notify.telegram_bot_ID #}
          {% set chat_id_part = target_entity_id | regex_replace(find='^.+_', replace='') | string | trim %}
          {% set final_id = chat_id_part %}
          
          {# –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ª–æ–≥–∏–∫—É –¥–ª—è –≥—Ä—É–ø–ø–æ–≤—ã—Ö —á–∞—Ç–æ–≤, –¥–æ–±–∞–≤–ª—è–µ–º "-" #}
          {% if final_id | length > 10 and not final_id.startswith('-') %}
            {% set final_id = '-' ~ final_id %}
          {% endif %}
        {% endif %}
        {{ final_id }}
        
  # 1. –ó–ê–ü–ò–°–¨ –í GOOGLE CALENDAR (–£–°–õ–û–í–ù–û–ï –í–´–ü–û–õ–ù–ï–ù–ò–ï)
  - choose:
      - conditions:
          - condition: template
            value_template: "{{ input_google_calendar is not none }}"
        sequence:
          - service: calendar.create_event
            data:
              start_date_time: "{{ now().isoformat() }}"
              end_date_time: "{{ (now() + timedelta(minutes=1)).isoformat() }}"
              # –ó–¥–µ—Å—å —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã, —á—Ç–æ–±—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –æ–±—â–µ–º—É —Å—Ç–∏–ª—é:
              summary: "–î–∞–≤: {{ sys }} / {{ dia }}, –ü—É–ª—å—Å {{ pulse }} | {{ now().strftime('%d.%m %H:%M') }}"
            target:
              entity_id: !input google_calendar

  # 2. –ó–ê–ü–ò–°–¨ –í GOOGLE SHEETS
  - service: google_sheets.append_sheet
    data:
      config_entry: !input google_sheets_config
      worksheet: !input google_sheets_worksheet
      data:
        –ì–æ–¥: "{{ now().strftime('%Y') }}"
        –ß–∏—Å–ª–æ: "{{ now().strftime('%-d') }}"
        –ú–µ—Å—è—Ü: >
          {% set month_num = now().month %}
          {% if month_num == 1 %}–Ø–Ω–≤–∞—Ä—å
          {% elif month_num == 2 %}–§–µ–≤—Ä–∞–ª—å
          {% elif month_num == 3 %}–ú–∞—Ä—Ç
          {% elif month_num == 4 %}–ê–ø—Ä–µ–ª—å
          {% elif month_num == 5 %}–ú–∞–π
          {% elif month_num == 6 %}–ò—é–Ω—å
          {% elif month_num == 7 %}–ò—é–ª—å
          {% elif month_num == 8 %}–ê–≤–≥—É—Å—Ç
          {% elif month_num == 9 %}–°–µ–Ω—Ç—è–±—Ä—å
          {% elif month_num == 10 %}–û–∫—Ç—è–±—Ä—å
          {% elif month_num == 11 %}–ù–æ—è–±—Ä—å
          {% else %}–î–µ–∫–∞–±—Ä—å{% endif %}
        –î–µ–Ω—å –Ω–µ–¥–µ–ª–∏: >
          {% set weekday_num = now().weekday() %}
          {% if weekday_num == 0 %}–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
          {% elif weekday_num == 1 %}–í—Ç–æ—Ä–Ω–∏–∫
          {% elif weekday_num == 2 %}–°—Ä–µ–¥–∞
          {% elif weekday_num == 3 %}–ß–µ—Ç–≤–µ—Ä–≥
          {% elif weekday_num == 4 %}–ü—è—Ç–Ω–∏—Ü–∞
          {% elif weekday_num == 5 %}–°—É–±–±–æ—Ç–∞
          {% else %}–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ{% endif %}
        –ü–µ—Ä–∏–æ–¥ –¥–Ω—è: >
          {% set hour = now().hour %}
          {% if hour >= 6 and hour < 12 %}–£—Ç—Ä–æ
          {% elif hour >= 12 and hour < 18 %}–î–µ–Ω—å
          {% elif hour >= 18 and hour < 23 %}–í–µ—á–µ—Ä
          {% else %}–ù–æ—á—å{% endif %}
        –í—Ä–µ–º—è: "{{ time_str }}"
        SYS: "{{ sys | float(0) }}"
        DIA: "{{ dia | float(0) }}"
        –ü—É–ª—å—Å: "{{ pulse | float(0) }}"

  # 3. –û–¢–ü–†–ê–í–ö–ê –í TELEGRAM (–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è)
  - service: telegram_bot.send_message
    metadata: {}
    data:
      chat_id: "{{ telegram_chat_id_str }}" 
      message: |
        üìä –ù–æ–≤–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ –∞—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è
        
        –í—Ä–µ–º—è: {{ date_str }} –≤ {{ time_str }}
        –î–∞–≤–ª–µ–Ω–∏–µ: {{ sys }} / {{ dia }} mmHg
        –ü—É–ª—å—Å: {{ pulse }} bpm
        
        {% if input_sheets_link | length > 0 %}
        üîó <a href="{{ input_sheets_link }}">–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ—Ä–µ–Ω–∏–π</a>
        {% endif %}
      parse_mode: html
        
mode: single
