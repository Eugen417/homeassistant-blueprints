blueprint: 
  name: ğŸ©¸ Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ Ğ°Ñ€Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ´Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ² Google + Telegram
  description: ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ ĞĞ” Ğ¸ Ğ¿ÑƒĞ»ÑŒÑ Ğ² Google Calendar/Sheets Ğ˜ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ² Telegram.
  domain: automation
  
  source_url: https://raw.githubusercontent.com/Eugen417/homeassistant-blueprints/refs/heads/main/blood_pressure_to_google.yaml
  
  input:
    # 1. Ğ¡Ğ•ĞĞ¡ĞĞ Ğ«
    sensor_systolic:
      name: ğŸ“ˆ Ğ¡ĞµĞ½ÑĞ¾Ñ€ ÑĞ¸ÑÑ‚Ğ¾Ğ»Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ ĞĞ” (SYS Ğ¸ Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€)
      description: Ğ¡ĞµĞ½ÑĞ¾Ñ€, ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‰Ğ¸Ğ¹ Ğ²ĞµÑ€Ñ…Ğ½ĞµĞµ (SYS) Ğ´Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ. Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ¾Ğ³Ğ¾ ÑĞµĞ½ÑĞ¾Ñ€Ğ° Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ.
      selector:
        entity:
          domain: sensor
          
    sensor_diastolic:
      name: ğŸ“‰ Ğ¡ĞµĞ½ÑĞ¾Ñ€ Ğ´Ğ¸Ğ°ÑÑ‚Ğ¾Ğ»Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ ĞĞ” (DIA)
      description: Ğ¡ĞµĞ½ÑĞ¾Ñ€, ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‰Ğ¸Ğ¹ Ğ½Ğ¸Ğ¶Ğ½ĞµĞµ (DIA) Ğ´Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ.
      selector:
        entity:
          domain: sensor

    sensor_heart_rate:
      name: â¤ï¸ Ğ¡ĞµĞ½ÑĞ¾Ñ€ Ğ¿ÑƒĞ»ÑŒÑĞ°
      description: Ğ¡ĞµĞ½ÑĞ¾Ñ€, ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‰Ğ¸Ğ¹ Ñ‡Ğ°ÑÑ‚Ğ¾Ñ‚Ñƒ Ğ¿ÑƒĞ»ÑŒÑĞ°.
      selector:
        entity:
          domain: sensor

    # 2. GOOGLE CALENDAR
    google_calendar:
      name: ğŸ“… Google Calendar (ĞĞµĞ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)
      description: Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ Google Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹. **ĞÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ Ğ¿ÑƒÑÑ‚Ñ‹Ğ¼, ĞµÑĞ»Ğ¸ Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾.**
      default: null 
      selector:
        entity:
          domain: calendar

    # 3. GOOGLE SHEETS
    google_sheets_config:
      name: ğŸ“‘ Google Sheets (ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ)
      description: Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ (ID) Ğ²Ğ°ÑˆĞµĞ¹ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Google Sheets.
      selector:
        select:
          options: []
          multiple: false
          custom_value: true
          
    google_sheets_worksheet:
      name: ğŸ“ Ğ˜Ğ¼Ñ Ğ»Ğ¸ÑÑ‚Ğ° Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ
      description: Ğ¢Ğ¾Ñ‡Ğ½Ğ¾Ğµ Ğ¸Ğ¼Ñ Ğ»Ğ¸ÑÑ‚Ğ°/Ğ²ĞºĞ»Ğ°Ğ´ĞºĞ¸ Ğ² Ğ²Ğ°ÑˆĞµĞ¹ Google Sheets (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, "Ğ›Ğ¸ÑÑ‚1").
      selector:
        text:

    # 4. TELEGRAM
    telegram_notify_target:
      name: ğŸ’¬ Ğ¦ĞµĞ»ĞµĞ²Ğ¾Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Telegram
      description: Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ *Ğ¦ĞµĞ»ÑŒ* (Target) Telegram Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ.
      selector:
        target:
          entity:
            - domain: notify
            
    sheets_link:
      name: ğŸ”— Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° Google Sheets
      description: URL-Ğ°Ğ´Ñ€ĞµÑ Ğ²Ğ°ÑˆĞµĞ¹ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Google Sheets Ğ´Ğ»Ñ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğ² ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Telegram.
      selector:
        text:

# =======================================================================
# ĞĞ’Ğ¢ĞĞœĞĞ¢Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯
# =======================================================================
trigger:
  - platform: state
    entity_id: !input sensor_systolic
    
condition:
  # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° SYS > 50 Ğ´Ğ»Ñ Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
  - condition: numeric_state
    entity_id: !input sensor_systolic
    above: 50 

action:
  # 0. ĞĞŸĞ Ğ•Ğ”Ğ•Ğ›Ğ•ĞĞ˜Ğ• ĞŸĞ•Ğ Ğ•ĞœĞ•ĞĞĞ«Ğ¥
  - variables:
      input_sensor_systolic: !input sensor_systolic
      input_sensor_diastolic: !input sensor_diastolic
      input_sensor_heart_rate: !input sensor_heart_rate
      input_google_calendar: !input google_calendar 
      input_telegram_target: !input telegram_notify_target
      input_sheets_link: !input sheets_link
      
      sys: "{{ states(input_sensor_systolic) | int(0) }}"
      dia: "{{ states(input_sensor_diastolic) | int(0) }}"
      pulse: "{{ states(input_sensor_heart_rate) | int(0) }}"
      
      time_str: "{{ now().strftime('%H:%M') }}"
      date_str: "{{ now().strftime('%Y-%m-%d') }}"
      
      # Ğ‘Ğ›ĞĞš TELEGRAM CHAT ID
      telegram_chat_id_str: >-
        {% set target_entity_id = input_telegram_target.get('entity_id', ['']) | first | default('') %}
        
        {% set final_id = '' %}
        {% if target_entity_id %}
          {# Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ñ Chat ID Ğ¸Ğ· Ğ¸Ğ¼ĞµĞ½Ğ¸ ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚Ğ¸ notify.telegram_bot_ID #}
          {% set chat_id_part = target_entity_id | regex_replace(find='^.+_', replace='') | string | trim %}
          {% set final_id = chat_id_part %}
          
          {# Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ Ğ´Ğ»Ñ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ¾Ğ²Ñ‹Ñ… Ñ‡Ğ°Ñ‚Ğ¾Ğ², Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ "-" #}
          {% if final_id | length > 10 and not final_id.startswith('-') %}
            {% set final_id = '-' ~ final_id %}
          {% endif %}
        {% endif %}
        {{ final_id }}
        
  # 1. Ğ—ĞĞŸĞ˜Ğ¡Ğ¬ Ğ’ GOOGLE CALENDAR (Ğ£Ğ¡Ğ›ĞĞ’ĞĞĞ• Ğ’Ğ«ĞŸĞĞ›ĞĞ•ĞĞ˜Ğ•)
  - choose:
      - conditions:
          - condition: template
            value_template: "{{ input_google_calendar is not none }}"
        sequence:
          - service: calendar.create_event
            data:
              start_date_time: "{{ now().isoformat() }}"
              end_date_time: "{{ (now() + timedelta(minutes=1)).isoformat() }}"
              summary: "Ğ”Ğ°Ğ²: {{ sys }} / {{ dia }}, ĞŸÑƒĞ»ÑŒÑ {{ pulse }} | {{ time_str }}"
            target:
              entity_id: !input google_calendar

  # 2. Ğ—ĞĞŸĞ˜Ğ¡Ğ¬ Ğ’ GOOGLE SHEETS
  - service: google_sheets.append_sheet
    data:
      config_entry: !input google_sheets_config
      worksheet: !input google_sheets_worksheet
      data:
        Ğ“Ğ¾Ğ´: "{{ now().strftime('%Y') }}"
        Ğ§Ğ¸ÑĞ»Ğ¾: "{{ now().strftime('%-d') }}"
        ĞœĞµÑÑÑ†: >
          {% set month_num = now().month %}
          {% if month_num == 1 %}Ğ¯Ğ½Ğ²Ğ°Ñ€ÑŒ
          {% elif month_num == 2 %}Ğ¤ĞµĞ²Ñ€Ğ°Ğ»ÑŒ
          {% elif month_num == 3 %}ĞœĞ°Ñ€Ñ‚
          {% elif month_num == 4 %}ĞĞ¿Ñ€ĞµĞ»ÑŒ
          {% elif month_num == 5 %}ĞœĞ°Ğ¹
          {% elif month_num == 6 %}Ğ˜ÑĞ½ÑŒ
          {% elif month_num == 7 %}Ğ˜ÑĞ»ÑŒ
          {% elif month_num == 8 %}ĞĞ²Ğ³ÑƒÑÑ‚
          {% elif month_num == 9 %}Ğ¡ĞµĞ½Ñ‚ÑĞ±Ñ€ÑŒ
          {% elif month_num == 10 %}ĞĞºÑ‚ÑĞ±Ñ€ÑŒ
          {% elif month_num == 11 %}ĞĞ¾ÑĞ±Ñ€ÑŒ
          {% else %}Ğ”ĞµĞºĞ°Ğ±Ñ€ÑŒ{% endif %}
        Ğ”ĞµĞ½ÑŒ Ğ½ĞµĞ´ĞµĞ»Ğ¸: >
          {% set weekday_num = now().weekday() %}
          {% if weekday_num == 0 %}ĞŸĞ¾Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¸Ğº
          {% elif weekday_num == 1 %}Ğ’Ñ‚Ğ¾Ñ€Ğ½Ğ¸Ğº
          {% elif weekday_num == 2 %}Ğ¡Ñ€ĞµĞ´Ğ°
          {% elif weekday_num == 3 %}Ğ§ĞµÑ‚Ğ²ĞµÑ€Ğ³
          {% elif weekday_num == 4 %}ĞŸÑÑ‚Ğ½Ğ¸Ñ†Ğ°
          {% elif weekday_num == 5 %}Ğ¡ÑƒĞ±Ğ±Ğ¾Ñ‚Ğ°
          {% else %}Ğ’Ğ¾ÑĞºÑ€ĞµÑĞµĞ½ÑŒĞµ{% endif %}
        ĞŸĞµÑ€Ğ¸Ğ¾Ğ´ Ğ´Ğ½Ñ: >
          {% set hour = now().hour %}
          {% if hour >= 6 and hour < 12 %}Ğ£Ñ‚Ñ€Ğ¾
          {% elif hour >= 12 and hour < 18 %}Ğ”ĞµĞ½ÑŒ
          {% elif hour >= 18 and hour < 23 %}Ğ’ĞµÑ‡ĞµÑ€
          {% else %}ĞĞ¾Ñ‡ÑŒ{% endif %}
        Ğ’Ñ€ĞµĞ¼Ñ: "{{ time_str }}"
        SYS: "{{ sys | float(0) }}"
        DIA: "{{ dia | float(0) }}"
        ĞŸÑƒĞ»ÑŒÑ: "{{ pulse | float(0) }}"

  # 3. ĞĞ¢ĞŸĞ ĞĞ’ĞšĞ Ğ’ TELEGRAM (ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ)
  - service: telegram_bot.send_message
    metadata: {}
    data:
      chat_id: "{{ telegram_chat_id_str }}"
      
      message: |
        ğŸ“Š ĞĞ¾Ğ²Ğ¾Ğµ Ğ¸Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ğµ Ğ°Ñ€Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ´Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ
        
        Ğ’Ñ€ĞµĞ¼Ñ: {{ date_str }} Ğ² {{ time_str }}
        Ğ”Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ: {{ sys }} / {{ dia }} mmHg
        ĞŸÑƒĞ»ÑŒÑ: {{ pulse }} bpm
        {% if input_sheets_link | length > 0 %}
        ğŸ”— <a href="{{ input_sheets_link }}">Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¸Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ğ¹</a>
        {% endif %}
      parse_mode: html
        
mode: single